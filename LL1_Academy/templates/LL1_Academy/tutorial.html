{% extends "LL1_Academy/_navbarPages.html" %}
{% load static %}
{% block title %}Tutorial{% endblock %}

<!--  -->

{% block templates %}
{% verbatim %}
<script id="grammar-template" type="text/x-handlebars-template">
	
		{{#each grammar}}
		<div class="productions">
			<p class="nt">{{ this.nt }}</p>
			<p>:==</p>
			{{#each this.productions}}
				{{#if @last }}
					<p class="t">{{ this }}</p>
				{{else}}
					<p class="t">{{ this }}</p>
					<p>|</p>
				{{/if}}
			{{/each}}
		</div>
		{{/each}}
</script>

<script id="question-template" type="text/x-handlebars-template">
  <div class="question" id="active" style="display: none">
  	<p class="question-help">{{helptext}}</p>
	<p class="question-title">{{question}}</p>
    <form id="question-input" onsubmit="return false;">
		{{#each terminals}}
			<div class="pretty info smooth">
				  <input type="checkbox" name="question-check" id="{{this}}-check" value="{{this}}"> 
				  <label for="{{this}}-check"><i class="im im-check-mark"></i>{{this}}</label>
				</div>
    	{{/each}}
    	<!-- TODO: make radio button question -->
    	<!--
			<input type="radio" name="ll1" value="True" id="input1" style="display:inline;" required> True
  			<input type="radio" name="ll1" value="False" id="input2" style="display:inline;margin-left:10px;"> False
		 -->
		<div class="feedback"></div>
		<div id="buttons-container">
	    	<!-- <button type="button" class="button" id="giveup">Give Up</button> -->
	    	<button type="submit" class="button" >Submit</button>
	    </div>
    </form>
  </div>  
</script>

{% endverbatim %}
{% endblock %}

<!--  -->

{% block content %}

<div class="row">
	<!-- full width explainer here -->
	<div class="small-12 columns" style="color: grey;">
		<div id="tutorialOptions" style="text-align:center;margin-bottom:15px;font-size:20px;">
			<a href="#" id="firstTutorial" style="margin: 0 15px 0 0;">First Set Tutorial</a>
			|<a href="#" id="followTutorial" style="margin: 0 15px 0 15px;">Follow Set Tutorial</a>
			|<a href="#" id="parseTutorial" style="margin: 0 0 0 15px;">Parse Table Tutorial</a>
		</div>
		<h3 style="font-family: 'Lato', sans-serif;">Welcome to the Tutorial Page!</h3>
		<p style="font-size:14px">Here you will learn how to determine the first sets, follow sets and parse table of a grammar, and therefore you will be able to check if a grammar is LL(1) by hand. The motivation for this exercise is for LL(1) parsing of an input string. This means the grammar fits into a class of grammars for which we can build a parser which can unambiguously determine the derivation of a string in the grammar in a single pass with no backtracking. (rewrite / expand)</p>
		<p style="font-size:14px">Already an expert? <a href="/practice">Start practicing!</a></p>
	</div>
	<div class="small-12 columns">
		<h3 style="font-family: 'Lato', sans-serif;">!! FIRST SET TUTORIAL/FOLLOW SET TUTORIAL/PARSE TABLE TUTORIAL !!</h3>
	</div>
	<!-- two column content below -->
	<div class="small-12 medium-6 columns" id="grammar-container">
		<h3>Grammar</h3>
		<div id="grammar">
		</div>
		<div style="display:flex; justify-content:space-between;">
			<div>
				<button class="button prevQ"><< Previous</button>
			</div>
			<button class="button nextQ">Next >></button>
		</div>
	</div>

	<div class="small-12 medium-6 columns">
		<h3>Questions</h3>
		<div id="questions-container"></div>
	</div>

</div>

{% endblock %}

<!--  -->

{% block pagescripts %}
<script>
	var grammar_template_src   = $("#grammar-template").html();
	var grammar_template = Handlebars.compile(grammar_template_src);
	var question_template_src   = $("#question-template").html();
	var question_template = Handlebars.compile(question_template_src);

	var questions;
	var currentQ;

	$(document).ready(function() {
		questions = firstQuestions;
		currentQ = 0;
		load_next_question();
	})

	var q1_grammar = {
		grammar: [
		{
			nt: 'A',
			productions: ['xy']
	    }]
	}


	var q2_grammar = {
		grammar: [
	    {
			nt: 'A',
			productions: ['xy','yz']
		}]
	}

	var q3_grammar = {
		grammar: [
		{
			nt: 'A',
			productions: ['Bx', 'z']
	    },
	    {
			nt: 'B',
			productions: ['y']
		}]
	}

	var q4_grammar = {
		grammar: [
		{
			nt: 'A',
			productions: ['BC', 'zC']
	    },
	    {
			nt: 'B',
			productions: ['Cx','yBy']
		},
		{
			nt: 'C',
			productions: ['xz']
		}]
	}
	
	var firstQuestions = [
		{
			grammar: q1_grammar,
			helptext: "To calculate the First Set of A, we need to calculate the First Set for the production “xy”. For this case, we just find first terminal symbol of the production. What is the first terminal symbol of “xy”?",
			question: "What is the first set of A?",
			answer: "x",
			type: "checkbox",
			terminals: ['x','y'],
		},
		{
			grammar: q2_grammar,
			helptext: "When there are multiple productions, we calculate the First Set of each production individually, and add each of them to the First Set. The First Set of A are the First Sets of “xy” and “yz” combined.",
			question: "What is the first set of A?",
			answer: "x,y",
			type: "checkbox",
			terminals: ['x','y','z'],
		},
		{
			grammar: q3_grammar,
			helptext: "When there is a nonterminal as the first symbol of a production, then the First Set of that symbol is the First Set of that production. In this case, the First Set of A is “z”, and the First Set of B. Hint: It would be good to calculate First Set of B first, and then substitute it into the First Set of A.",
			question: "What is the first set of B?",
			answer: "y",
			type: "checkbox",
			terminals: ['x','y','z'],
		},
		{
			grammar: q3_grammar,
			helptext: "When there is a nonterminal as the first symbol of a production, then the First Set of that symbol is the First Set of that production. In this case, the First Set of A is “z”, and the First Set of B. Hint: It would be good to calculate First Set of B first, and then substitute it into the First Set of A.",
			question: "What is the first set of A?",
			answer: "y,z",
			type: "checkbox",
			terminals: ['x','y','z'],
		},
		{
			grammar: q4_grammar,
			helptext: "This is a challenge problem",
			question: "What is the first set of A?",
			answer: "x,y,z",
			type: "checkbox",
			terminals: ['x','y','z'],
		},
		{
			grammar: q4_grammar,
			helptext: "This is a challenge problem",
			question: "What is the first set of B?",
			answer: "x,z",
			type: "checkbox",
			terminals: ['x','y','z'],
		},
		{
			grammar: q4_grammar,
			helptext: "This is a challenge problem",
			question: "What is the first set of C?",
			answer: "x",
			type: "checkbox",
			terminals: ['x','y','z'],
		}
	]

	var followQuestions = [
		// filler code
		{
			grammar: q3_grammar,
			helptext: "THIS IS FILLER CODE FOR FOLLOW QUESTIONS",
			question: "THIS IS FILLER CODE FOR FOLLOW QUESTIONS",
			answer: "y,z",
			type: "checkbox",
			terminals: ['x','y','z'],
		}
	]

	var parseQuestions = [
		// filler code
		{
			grammar: q3_grammar,
			helptext: "THIS IS FILLER CODE FOR PARSE TABLE QUESTIONS",
			question: "THIS IS FILLER CODE FOR PARSE TABLE QUESTIONS",
			answer: "y",
			type: "checkbox",
			terminals: ['x','y','z'],
		}
	]
	
	$('#firstTutorial').click(function() {
		questions = firstQuestions
		currentQ = 0;
		load_next_question()
	});
	$('#followTutorial').click(function() {
		questions = followQuestions
		currentQ = 0;
		load_next_question()
	});
	$('#parseTutorial').click(function() {
		questions = parseQuestions
		currentQ = 0;
		load_next_question();
	});

	$('.button.prevQ').click(function() {
		currentQ -= 2;
		load_next_question(); 
	});
	$('.button.nextQ').click(function() {
		load_next_question(); 
	});

	function load_next_question() {
		if (currentQ < 0){
			currentQ = 0;
		}

		if (currentQ == questions.length) {
			console.log("out of questions do something")
			if (questions[0] == firstQuestions[0]){
				swal({
					title: "Tutorial Complete!",
					text: "Congratuations on completing the First Set tutorial!",
					type: "success",
					html:true,
					confirmButtonText: "Continue to Follow Set Tutorial"
				},
				function() {
					questions = followQuestions;
					currentQ = 0;
					load_next_question();
				});
			} else if (questions[0] == followQuestions[0]){
				swal({
					title: "Tutorial Complete!",
					text: "Congratuations on completing the Follow Set tutorial!",
					type: "success",
					html:true,
					confirmButtonText: "Continue to Parse Table Tutorial"
				}, 
				function() {
					questions = parseQuestions;
					currentQ = 0;
					load_next_question();
				});
			} else if (questions[0] == parseQuestions[0]){
				swal({
					title: "Tutorial Complete!",
					text: "Congratuations on completing the Parse Table tutorial!",
					type: "success",
					html:true,
					confirmButtonText: "Start Practicing"
				},
				function() {
					window.location.href = '/practice';
				});
			}
			return
		}

		if (currentQ == 0) {
			$('.button.prevQ').hide();
		} else {
			$('.button.prevQ').show();
		}

		curQ = questions[currentQ];
		console.log(currentQ);
		currentQ++;
		
		console.log(curQ);

		if (curQ.grammar)
			$('#grammar').html(grammar_template(curQ.grammar))

		if (curQ.type == "checkbox") {
			$('#questions-container').html(question_template(curQ));
			$('#active').fadeIn({duration:800});

			// submit handler:
			$('#question-input').on('submit', function() {
				var answer = []
				$("input[name=question-check]:checked").each(function() {
					answer.push($(this).val());
				});
				// answer is right so:
				if (answer.join(',') === curQ.answer) {
					$('#question-input').remove()
					$('#active').removeAttr('id')
					load_next_question();
				} else {
					$('#question-input > .feedback').html("<p>Incorrect answer</p>")
				}

			});

		} else {
			console.log("non-checkbox questions not implemented yet")
		}
	}
</script>
{% endblock %}